<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11–ê-2026</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: #e5e5e5; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }
        .gold-text { background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .gold-bg { background: linear-gradient(135deg, #bf953f, #b38728); }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .card-shadow { box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        .admin-glass { background: rgba(10, 10, 10, 0.98); border-left: 1px solid rgba(191, 149, 63, 0.3); }
        input, textarea, select { background: rgba(0,0,0,0.5) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #bf953f; border-radius: 10px; }
        .fade-in { animation: fadeIn 1.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_URL = window.location.origin; 

        const getClientId = () => {
            let clientId = localStorage.getItem('client_id');
            if (!clientId) {
                clientId = window.crypto?.randomUUID
                    ? window.crypto.randomUUID()
                    : `cid_${Date.now()}_${Math.random().toString(16).slice(2)}`;
                localStorage.setItem('client_id', clientId);
            }
            return clientId;
        };

        const apiFetch = (path, options = {}) => {
            const headers = new Headers(options.headers || {});
            headers.set('x-client-id', getClientId());
            return fetch(`${API_URL}${path}`, { ...options, headers });
        };

        const Spinner = () => <div className="flex justify-center p-4"><div className="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-yellow-500"></div></div>;

        // --- ADMIN COMPONENTS ---
        const AdminPanel = ({ token, onLogout, refreshApp }) => {
            const [data, setData] = useState(null);
            const [activeTab, setActiveTab] = useState('settings');

            useEffect(() => {
                fetch(`${API_URL}/api/admin/data`, { headers: { 'x-admin-token': token } })
                    .then(r => r.json())
                    .then(res => {
                        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
                        if (!res.settings.footer) {
                            res.settings.footer = { logo_url: "", description: "–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –Ω–∞—Ä–æ–¥–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞.", copyright: "¬© 2025 City Voting Platform", links: [] };
                        }
                        if (!res.settings.header) {
                            res.settings.header = { show_logo: true, logo_path: "/assets/win.png" };
                        }
                        setData(res);
                    });
            }, []);

            const save = async (path, body) => {
                const res = await fetch(`${API_URL}/api/admin/${path}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-admin-token': token },
                    body: JSON.stringify(body)
                });
                if (res.ok) {
                    alert("–£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ");
                    refreshApp();
                }
            };

            const addFooterLink = () => {
                const newSettings = {...data.settings};
                newSettings.footer.links.push({ label: "Telegram", url: "#" });
                setData({...data, settings: newSettings});
            };

            const removeFooterLink = (idx) => {
                const newSettings = {...data.settings};
                newSettings.footer.links = newSettings.footer.links.filter((_, i) => i !== idx);
                setData({...data, settings: newSettings});
            };

            const addCategory = () => {
                const newCat = { id: `cat_${Date.now()}`, title: "–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è", max_votes: 1, participants: [] };
                setData({...data, categories: [...data.categories, newCat]});
            };

            const addParticipant = (catIdx) => {
                const newPart = { id: `p_${Date.now()}`, name: "–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫", description: "", image_url: "https://placehold.co/400x600/1a1a1a/gold?text=Photo" };
                const newCats = [...data.categories];
                newCats[catIdx].participants.push(newPart);
                setData({...data, categories: newCats});
            };

            if (!data) return <div className="fixed inset-0 bg-black flex items-center justify-center z-[100]"><Spinner /></div>;

            return (
                <div className="fixed inset-0 z-50 admin-glass overflow-y-auto p-4 md:p-10 text-white pb-32">
                    <div className="max-w-6xl mx-auto">
                        <div className="flex justify-between items-center mb-10 border-b border-white/10 pb-6">
                            <div>
                                <h2 className="text-3xl font-bold gold-text">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
                                <p className="text-xs text-gray-500 mt-2">
                                    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: <span className="text-yellow-500 font-semibold">{data.users?.length || 0}</span> ¬∑ –ì–æ–ª–æ—Å–∞: <span className="text-yellow-500 font-semibold">{data.votes?.length || 0}</span>
                                </p>
                            </div>
                            <div className="flex gap-4">
                                <button onClick={() => { save('settings', data.settings); save('categories', data.categories); }} className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-bold transition-colors">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë</button>
                                <button onClick={onLogout} className="bg-white/5 hover:bg-red-900/40 px-4 py-2 rounded-lg transition-colors border border-white/10">–í—ã–π—Ç–∏</button>
                            </div>
                        </div>
                        
                        <div className="flex gap-4 mb-8 overflow-x-auto pb-2">
                            {['settings', 'categories', 'footer'].map(t => (
                                <button key={t} onClick={() => setActiveTab(t)} className={`px-6 py-3 rounded-xl transition-all whitespace-nowrap ${activeTab === t ? 'gold-bg text-black font-bold scale-105 shadow-lg shadow-yellow-500/20' : 'bg-white/5 hover:bg-white/10 border border-white/10'}`}>
                                    {t === 'settings' ? '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏' : t === 'categories' ? 'üèÜ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏' : 'üìÑ –§—É—Ç–µ—Ä'}
                                </button>
                            ))}
                        </div>

                        {activeTab === 'settings' && (
                            <div className="glass p-8 rounded-3xl space-y-8">
                                <section className="space-y-4">
                                    <h3 className="text-lg font-bold gold-text">–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                                    <div>
                                        <label className="block mb-2 text-sm text-gray-400">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</label>
                                        <input value={data.settings.title} onChange={e => setData({...data, settings: {...data.settings, title: e.target.value}})} className="w-full p-4 rounded-xl outline-none" />
                                    </div>
                                    <div className="flex items-center justify-between p-4 bg-white/5 rounded-2xl border border-white/10">
                                        <span>–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ</span>
                                        <input type="checkbox" checked={data.settings.is_voting_active} onChange={e => setData({...data, settings: {...data.settings, is_voting_active: e.target.checked}})} className="w-6 h-6 accent-yellow-500" />
                                    </div>
                                    <div className="flex items-center justify-between p-4 bg-white/5 rounded-2xl border border-white/10">
                                        <span>–ê–Ω—Ç–∏–∞–±—å—é–∑ (–ª–∏–º–∏—Ç—ã –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)</span>
                                        <input type="checkbox" checked={data.settings.anti_abuse_enabled} onChange={e => setData({...data, settings: {...data.settings, anti_abuse_enabled: e.target.checked}})} className="w-6 h-6 accent-yellow-500" />
                                    </div>
                                </section>

                                <section className="space-y-4 border-t border-white/5 pt-6">
                                    <h3 className="text-lg font-bold gold-text">–®–∞–ø–∫–∞ (Header)</h3>
                                    <div className="flex items-center justify-between p-4 bg-white/5 rounded-2xl border border-white/10">
                                        <div>
                                            <p className="font-semibold">–ì–ª–∞–≤–Ω—ã–π –ª–æ–≥–æ—Ç–∏–ø (win.png)</p>
                                            <p className="text-xs text-gray-400">–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º</p>
                                        </div>
                                        <input type="checkbox" checked={data.settings.header?.show_logo} onChange={e => setData({...data, settings: {...data.settings, header: {...data.settings.header, show_logo: e.target.checked}}})} className="w-6 h-6 accent-yellow-500" />
                                    </div>
                                    <div>
                                        <label className="block mb-2 text-sm text-gray-400">–ü—É—Ç—å –∫ –ª–æ–≥–æ—Ç–∏–ø—É</label>
                                        <input value={data.settings.header?.logo_path || ""} onChange={e => setData({...data, settings: {...data.settings, header: {...data.settings.header, logo_path: e.target.value}}})} className="w-full p-3 rounded-lg" placeholder="/assets/win.png" />
                                    </div>
                                </section>
                            </div>
                        )}

                        {activeTab === 'categories' && (
                            <div className="space-y-10">
                                {data.categories.map((cat, idx) => (
                                    <div key={cat.id} className="glass p-8 rounded-3xl border-l-4 border-yellow-500 relative">
                                        <button onClick={() => { if(confirm("–£–¥–∞–ª–∏—Ç—å?")) setData({...data, categories: data.categories.filter((_, i) => i !== idx)})}} className="absolute top-8 right-8 text-red-500">–£–¥–∞–ª–∏—Ç—å</button>
                                        <input value={cat.title} onChange={e => {
                                            const c = [...data.categories];
                                            c[idx].title = e.target.value;
                                            setData({...data, categories: c});
                                        }} className="w-full text-2xl font-bold gold-text p-2 rounded bg-transparent mb-6" />
                                        <div className="mb-6">
                                            <label className="block mb-2 text-xs text-gray-400 uppercase tracking-widest">–õ–∏–º–∏—Ç –≥–æ–ª–æ—Å–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                                            <input type="number" min="1" value={cat.max_votes} onChange={e => {
                                                const c = [...data.categories];
                                                c[idx].max_votes = Number(e.target.value);
                                                setData({...data, categories: c});
                                            }} className="w-40 p-2 text-sm rounded" />
                                        </div>
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {cat.participants.map((p, pIdx) => (
                                                <div key={p.id} className="bg-white/5 p-4 rounded-2xl border border-white/10 space-y-2">
                                                    <input value={p.name} placeholder="–ò–º—è" onChange={e => {
                                                        const c = [...data.categories];
                                                        c[idx].participants[pIdx].name = e.target.value;
                                                        setData({...data, categories: c});
                                                    }} className="w-full p-2 text-sm" />
                                                    <textarea value={p.description} placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" onChange={e => {
                                                        const c = [...data.categories];
                                                        c[idx].participants[pIdx].description = e.target.value;
                                                        setData({...data, categories: c});
                                                    }} className="w-full p-2 text-xs h-20 resize-none" />
                                                    <input value={p.image_url} placeholder="URL —Ñ–æ—Ç–æ" onChange={e => {
                                                        const c = [...data.categories];
                                                        c[idx].participants[pIdx].image_url = e.target.value;
                                                        setData({...data, categories: c});
                                                    }} className="w-full p-2 text-xs" />
                                                    <button onClick={() => {
                                                        const c = [...data.categories];
                                                        c[idx].participants = c[idx].participants.filter((_, i) => i !== pIdx);
                                                        setData({...data, categories: c});
                                                    }} className="text-xs text-red-400">–£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</button>
                                                </div>
                                            ))}
                                            <button onClick={() => addParticipant(idx)} className="border-2 border-dashed border-white/10 rounded-2xl p-4 text-xs">+ –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</button>
                                        </div>
                                    </div>
                                ))}
                                <button onClick={addCategory} className="w-full border-2 border-dashed border-yellow-500/30 p-8 rounded-3xl text-yellow-500 font-bold">–ù–û–í–ê–Ø –ö–ê–¢–ï–ì–û–†–ò–Ø</button>
                            </div>
                        )}

                        {activeTab === 'footer' && (
                            <div className="glass p-8 rounded-3xl space-y-6">
                                <h3 className="text-xl font-bold gold-text mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∏–∂–Ω–µ–≥–æ –±–ª–æ–∫–∞ (–§—É—Ç–µ—Ä–∞)</h3>
                                <div className="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <label className="block mb-2 text-sm text-gray-400">URL –õ–æ–≥–æ—Ç–∏–ø–∞</label>
                                        <input value={data.settings.footer?.logo_url || ""} onChange={e => setData({...data, settings: {...data.settings, footer: {...data.settings.footer, logo_url: e.target.value}}})} className="w-full p-3 rounded-lg" placeholder="https://..." />
                                    </div>
                                    <div>
                                        <label className="block mb-2 text-sm text-gray-400">Copyright —Ç–µ–∫—Å—Ç</label>
                                        <input value={data.settings.footer?.copyright || ""} onChange={e => setData({...data, settings: {...data.settings, footer: {...data.settings.footer, copyright: e.target.value}}})} className="w-full p-3 rounded-lg" />
                                    </div>
                                </div>
                                <div>
                                    <label className="block mb-2 text-sm text-gray-400">–û–ø–∏—Å–∞–Ω–∏–µ –≤ —Ñ—É—Ç–µ—Ä–µ</label>
                                    <textarea value={data.settings.footer?.description || ""} onChange={e => setData({...data, settings: {...data.settings, footer: {...data.settings.footer, description: e.target.value}}})} className="w-full p-3 rounded-lg h-24 resize-none" />
                                </div>
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <h4 className="font-bold">–°—Å—ã–ª–∫–∏ –∏ —Å–æ—Ü—Å–µ—Ç–∏</h4>
                                        <button onClick={addFooterLink} className="text-xs gold-text">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {(data.settings.footer?.links || []).map((link, lIdx) => (
                                            <div key={lIdx} className="bg-white/5 p-4 rounded-xl border border-white/10 flex gap-2 items-center">
                                                <input value={link.label} placeholder="–¢–µ–∫—Å—Ç" onChange={e => {
                                                    const s = {...data.settings};
                                                    s.footer.links[lIdx].label = e.target.value;
                                                    setData({...data, settings: s});
                                                }} className="w-1/3 p-2 text-xs" />
                                                <input value={link.url} placeholder="URL" onChange={e => {
                                                    const s = {...data.settings};
                                                    s.footer.links[lIdx].url = e.target.value;
                                                    setData({...data, settings: s});
                                                }} className="w-full p-2 text-xs" />
                                                <button onClick={() => removeFooterLink(lIdx)} className="text-red-500 px-2">X</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- PUBLIC APP ---
        const CategoryView = ({ cat, myVotes, settings, results, onVote, onReset }) => {
            const votesCount = myVotes[cat.id]?.length || 0;
            const limit = cat.max_votes || 1;

            return (
                <div className="glass p-4 md:p-6 rounded-3xl flex flex-col h-full card-shadow border border-white/5 hover:border-white/10 transition-all">
                    <div className="mb-4">
                        <div className="flex justify-between items-start">
                            <h3 className="text-xl md:text-2xl font-bold gold-text leading-tight">{cat.title}</h3>
                            {settings.is_voting_active && votesCount > 0 && (
                                <button onClick={() => onReset(cat.id)} className="text-[9px] uppercase font-bold text-red-400 border border-red-900/30 px-2 py-1 rounded-lg">–°–±—Ä–æ—Å</button>
                            )}
                        </div>
                    </div>
                    <div className="space-y-4 flex-grow">
                        {cat.participants.map(p => {
                            const isVoted = myVotes[cat.id]?.includes(p.id);
                            const canVote = votesCount < limit || isVoted;
                            let percent = 0;
                            let isWinner = false;
                            if (!settings.is_voting_active && results.visible && results.data[cat.id]) {
                                const total = Object.values(results.data[cat.id]).reduce((a, b) => a + b, 0);
                                const count = results.data[cat.id][p.id] || 0;
                                percent = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
                                isWinner = count === Math.max(...Object.values(results.data[cat.id])) && count > 0;
                            }
                            return (
                                <div key={p.id} className={`relative p-3 rounded-2xl border transition-all ${isVoted ? 'bg-yellow-500/10 border-yellow-500/50' : 'border-white/5'}`}>
                                    <div className="flex items-center gap-4">
                                        <div className="w-14 h-14 rounded-xl overflow-hidden flex-shrink-0 bg-gray-900">
                                            <img src={p.image_url} alt="" className="w-full h-full object-cover" />
                                        </div>
                                        <div className="flex-grow min-w-0">
                                            <p className="text-sm font-bold truncate">{p.name}</p>
                                            {p.description && (
                                                <p className="text-[11px] text-gray-400 mt-1 break-words">{p.description}</p>
                                            )}
                                            {!settings.is_voting_active && results.visible && (
                                                <div className="w-full bg-white/5 h-1 rounded-full mt-2 overflow-hidden">
                                                    <div className={`h-full ${isWinner ? 'bg-yellow-500' : 'bg-gray-600'}`} style={{width: `${percent}%`}}></div>
                                                </div>
                                            )}
                                        </div>
                                        <div className="flex-shrink-0">
                                            {settings.is_voting_active ? (
                                                <button onClick={() => !isVoted && canVote && onVote(cat.id, p.id)} disabled={!canVote || isVoted} className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${isVoted ? 'bg-green-500' : canVote ? 'bg-white/5 hover:bg-yellow-500 hover:text-black' : 'opacity-10'}`}>
                                                    <span className="text-lg font-black">{isVoted ? '‚úì' : '+'}</span>
                                                </button>
                                            ) : (
                                                <span className={`text-xs font-black ${isWinner ? 'text-yellow-500' : 'text-gray-500'}`}>{percent}%</span>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('home');
            const storedVotes = JSON.parse(localStorage.getItem('my_votes') || '{}');
            const [data, setData] = useState({ categories: [], settings: null, myVotes: storedVotes, results: { visible: false } });
            const [loading, setLoading] = useState(true);
            const [adminToken, setAdminToken] = useState(localStorage.getItem('admin_token'));
            const [userId, setUserId] = useState(localStorage.getItem('user_id') || '');
            const [lastSync, setLastSync] = useState(localStorage.getItem('last_sync') || '');

            const loadData = async () => {
                try {
                    const [st, cats, mVotes, res] = await Promise.all([
                        apiFetch(`/api/status`).then(r => r.json()),
                        apiFetch(`/api/categories`).then(r => r.json()),
                        apiFetch(`/api/my-votes`).then(r => r.json()),
                        apiFetch(`/api/results`).then(r => r.json())
                    ]);
                    setData({ settings: st, categories: cats, myVotes: mVotes, results: res });
                    localStorage.setItem('my_votes', JSON.stringify(mVotes));
                    const syncStamp = new Date().toLocaleString();
                    localStorage.setItem('last_sync', syncStamp);
                    setLastSync(syncStamp);
                } catch (e) { console.error(e); }
                setLoading(false);
            };

            useEffect(() => { loadData(); }, []);

            useEffect(() => {
                const clientId = getClientId();
                fetch(`${API_URL}/api/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ client_id: clientId })
                })
                    .then(r => r.json())
                    .then(res => {
                        if (res.user_id) {
                            setUserId(res.user_id);
                            localStorage.setItem('user_id', res.user_id);
                        }
                    });
            }, []);

            useEffect(() => {
                localStorage.setItem('my_votes', JSON.stringify(data.myVotes));
            }, [data.myVotes]);

            const handleVote = async (catId, pId) => {
                const prev = data.myVotes;
                const nextVotes = { ...data.myVotes, [catId]: [...(data.myVotes[catId] || []), pId] };
                setData({ ...data, myVotes: nextVotes });
                try {
                    const res = await apiFetch(`/api/vote`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ category_id: catId, participant_id: pId })
                    });
                    if (!res.ok) throw new Error();
                } catch { setData({ ...data, myVotes: prev }); }
            };

            const handleReset = async (catId) => {
                const res = await apiFetch(`/api/vote/reset`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ category_id: catId })
                });
                if (res.ok) {
                    const next = { ...data.myVotes };
                    delete next[catId];
                    setData({ ...data, myVotes: next });
                }
            };

            if (loading) return <div className="h-screen flex items-center justify-center bg-black"><Spinner /></div>;

            const header = data.settings?.header || { show_logo: true, logo_path: "/assets/win.png" };
            const footer = data.settings?.footer || {};

            return (
                <div className="min-h-screen pb-0 selection:bg-yellow-500/30">
                    {view === 'admin' && adminToken && (
                        <AdminPanel token={adminToken} onLogout={() => { setAdminToken(null); localStorage.removeItem('admin_token'); setView('home'); }} refreshApp={loadData} />
                    )}

                    <header className="pt-16 pb-12 md:pt-24 md:pb-24 text-center px-4 relative">
                        {header.show_logo && (
                            <div className="mb-6 flex justify-center fade-in">
                                <img src={header.logo_path} alt="Award Logo" className="w-60 h-30 md:w-60 md:h-30 object-contain drop-shadow-[0_0_15px_rgba(191,149,63,0.3)]" />
                            </div>
                        )}
                        <h1 className="text-5xl md:text-8xl font-bold gold-text mb-4 uppercase tracking-tighter drop-shadow-2xl fade-in">
                            {data.settings?.title}
                        </h1>
                        <p className="text-gray-500 uppercase tracking-[0.3em] text-[10px] md:text-xs font-bold italic fade-in" style={{animationDelay: '0.2s'}}>
                            –¢–≤–æ–π –≥–æ–ª–æ—Å –º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å –≤—Å—ë!
                        </p>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 md:px-8 mb-32">
                        <div className="glass p-4 md:p-6 rounded-3xl mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4 card-shadow border border-white/10">
                            <div>
                                <p className="text-xs uppercase tracking-widest text-gray-500 mb-2">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</p>
                                <div className="flex flex-wrap items-center gap-3">
                                    <span className="text-sm font-semibold text-white/90">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</span>
                                    <span className="px-3 py-1 rounded-full bg-white/5 border border-white/10 text-xs tracking-wider">{userId || '...—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è'}</span>
                                </div>
                                <p className="text-xs text-gray-500 mt-2">–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: {lastSync || '–æ–∂–∏–¥–∞–Ω–∏–µ...'}</p>
                            </div>
                            <div className="flex flex-wrap gap-3">
                                <div className="px-4 py-2 rounded-2xl bg-white/5 border border-white/10 text-xs uppercase tracking-widest text-gray-400">
                                    –í—ã–±—Ä–∞–Ω–æ –≥–æ–ª–æ—Å–æ–≤: <span className="text-yellow-500 font-bold ml-2">{Object.values(data.myVotes).reduce((acc, arr) => acc + arr.length, 0)}</span>
                                </div>
                                <button onClick={loadData} className="px-4 py-2 rounded-2xl border border-yellow-500/40 text-xs uppercase tracking-widest text-yellow-500 hover:bg-yellow-500 hover:text-black transition-all">
                                    –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                                </button>
                            </div>
                        </div>
                        <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-8">
                            {data.categories.map(cat => (
                                <CategoryView key={cat.id} cat={cat} myVotes={data.myVotes} settings={data.settings} results={data.results} onVote={handleVote} onReset={handleReset} />
                            ))}
                        </div>
                    </main>

                    <footer className="bg-black/80 border-t border-white/5 pt-20 pb-10 px-6">
                        <div className="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-12 mb-16">
                            <div className="space-y-6 text-center md:text-left">
                                {footer.logo_url && <img src={footer.logo_url} className="h-12 mx-auto md:mx-0 object-contain" alt="Footer Logo" />}
                                <p className="text-gray-400 text-sm max-w-sm mx-auto md:mx-0 leading-relaxed">
                                    {footer.description || "–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è."}
                                </p>
                            </div>
                            <div className="flex flex-col items-center justify-center gap-4">
                                <h4 className="text-xs font-bold uppercase tracking-widest text-gray-500 mb-2">–ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ —Å–æ—Ü—Å–µ—Ç–∏</h4>
                                <div className="flex flex-wrap justify-center gap-4">
                                    {(footer.links || []).map((link, idx) => (
                                        <a key={idx} href={link.url} target="_blank" className="text-sm gold-text hover:brightness-125 transition-all underline underline-offset-4 decoration-yellow-500/30">
                                            {link.label}
                                        </a>
                                    ))}
                                </div>
                            </div>
                            <div className="flex flex-col items-center md:items-end justify-center gap-4">
                                <button onClick={() => {
                                    const pass = prompt("–ü–∞—Ä–æ–ª—å:");
                                    fetch(`${API_URL}/api/admin/login`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({password:pass}) })
                                        .then(r => r.json()).then(res => {
                                            if(res.token) { setAdminToken(res.token); localStorage.setItem('admin_token', res.token); setView('admin'); }
                                        });
                                }} className="px-6 py-2 rounded-full border border-white/10 text-[10px] uppercase font-bold text-gray-500 hover:text-yellow-500 hover:border-yellow-500/50 transition-all">
                                    Admin Access
                                </button>
                                <p className="text-[10px] text-gray-700 tracking-wider">SECURE VOTING SYSTEM v2.1</p>
                            </div>
                        </div>
                        <div className="text-center border-t border-white/5 pt-8 space-y-3">
                            <p className="text-gray-600 text-[10px] uppercase tracking-[0.2em]">
                                {footer.copyright || "¬© 2025 City Voting Platform"}
                            </p>
                            <p className="text-gray-500 text-[10px] uppercase tracking-[0.2em]">
                                –í–∞—à ID: <span className="text-yellow-500">{userId || '—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...'}</span>
                            </p>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
