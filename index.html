<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SCHOOL SLAY AWARDS 2025 ‚Äî Online Voting</title>
  <meta name="description" content="SCHOOL SLAY AWARDS 2025 ‚Äî –æ–Ω–ª–∞–π–Ω-–≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ: –Ω–æ–º–∏–Ω–∞—Ü–∏–∏, –∫–∞–Ω–¥–∏–¥–∞—Ç—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã." />
  <!-- TailwindCSS CDN (–æ–∫ –¥–ª—è –¥–µ–º–æ/—à–∫–æ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["system-ui", "ui-sans-serif", "Inter", "sans-serif"] },
          colors: {
            neon: { pink: "#ff4ecd", purple: "#a855f7", cyan: "#22d3ee" }
          },
          boxShadow: {
            glow: "0 0 80px rgba(244, 114, 182, 0.35)"
          }
        }
      }
    };
  </script>
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif; }
    .glass {
      background: linear-gradient(135deg, rgba(15,23,42,0.85), rgba(24,24,27,0.85));
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: 0 22px 70px rgba(15,23,42,0.85);
      backdrop-filter: blur(20px);
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-black text-slate-100">
  <div id="root"></div>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Firebase (compat API –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <!-- Babel –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ JSX –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    // --- Firebase init -------------------------------------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyCDXF_Oi8EvO891rhHA1a7YovzQjadkXzs",
      authDomain: "school-slay-2025.firebaseapp.com",
      projectId: "school-slay-2025",
      storageBucket: "school-slay-2025.firebasestorage.app",
      messagingSenderId: "399947235194",
      appId: "1:399947235194:web:0fa70f60052dccc06360c3",
      measurementId: "G-L37NYESHC7"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    // --- React hooks ---------------------------------------------------------
    const { useState, useEffect, useContext, createContext } = React;

    // --- –ü—Ä–æ—Å—Ç–æ–π hash-—Ä–æ—É—Ç–µ—Ä -------------------------------------------------
    function parseHash() {
      let hash = window.location.hash || "#/";
      hash = hash.replace(/^#/, "");
      if (!hash.startsWith("/")) hash = "/" + hash;
      const path = hash;
      const segments = path.split("/").filter(Boolean); // ['categories', 'abc']

      let name = "home";
      const params = {};

      if (segments.length === 0) {
        name = "home";
      } else if (segments[0] === "categories") {
        if (segments[1]) {
          name = "categoryDetail";
          params.categoryId = segments[1];
        } else {
          name = "categories";
        }
      } else if (segments[0] === "results") {
        name = "results";
      } else if (segments[0] === "admin") {
        name = "admin";
      } else {
        name = "notfound";
      }

      return { name, path, segments, params };
    }

    function normalizeTo(to) {
      if (!to) return "/";
      if (to.startsWith("#")) to = to.slice(1);
      if (!to.startsWith("/")) to = "/" + to;
      return to;
    }

    const RouterContext = createContext(null);

    const RouterProvider = ({ children }) => {
      const [route, setRoute] = useState(() => parseHash());

      useEffect(() => {
        if (!window.location.hash) {
          window.location.hash = "#/";
        }
        const handler = () => setRoute(parseHash());
        window.addEventListener("hashchange", handler);
        return () => window.removeEventListener("hashchange", handler);
      }, []);

      const navigate = (to) => {
        const norm = normalizeTo(to);
        if ("#" + norm === window.location.hash) return;
        window.location.hash = "#" + norm;
      };

      return (
        <RouterContext.Provider value={{ route, navigate }}>
          {children}
        </RouterContext.Provider>
      );
    };

    const useRouter = () => useContext(RouterContext);

    const Link = ({ to, children, className }) => {
      const { navigate } = useRouter();
      const handleClick = (e) => {
        e.preventDefault();
        navigate(to);
      };
      const href = "#" + normalizeTo(to);
      return (
        <a href={href} className={className} onClick={handleClick}>
          {children}
        </a>
      );
    };

    const NavLink = ({ to, children, className }) => {
      const { route, navigate } = useRouter();
      const handleClick = (e) => {
        e.preventDefault();
        navigate(to);
      };
      const href = "#" + normalizeTo(to);
      const targetPath = normalizeTo(to);
      const isActive =
        route.path === targetPath ||
        (targetPath !== "/" && route.path.startsWith(targetPath));

      const finalClass =
        typeof className === "function" ? className({ isActive }) : className;

      return (
        <a href={href} className={finalClass} onClick={handleClick}>
          {children}
        </a>
      );
    };

    // !!! –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏—á–Ω—ã–º –¥–µ–ø–ª–æ–µ–º !!!
    const ADMIN_PASSWORD = "slay2025";

    // --- Firestore helpers ---------------------------------------------------
    async function voteWithCode({ code, categoryId, candidateId }) {
      const trimmed = code.trim().toUpperCase();
      if (!trimmed) {
        return { ok: false, message: "–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è." };
      }

      const codesRef = db.collection("codes");
      const snap = await codesRef.where("code", "==", trimmed).limit(1).get();

      if (snap.empty) {
        return { ok: false, message: "–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑." };
      }

      const doc = snap.docs[0];
      const data = doc.data();

      if (data.used) {
        return { ok: false, message: "–≠—Ç–æ—Ç –∫–æ–¥ —É–∂–µ –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω." };
      }

      if (data.categoryId && data.categoryId !== categoryId) {
        return { ok: false, message: "–≠—Ç–æ—Ç –∫–æ–¥ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –¥—Ä—É–≥–æ–π –Ω–æ–º–∏–Ω–∞—Ü–∏–∏." };
      }

      const type = data.type || "audience";

      const batch = db.batch();
      const voteRef = db.collection("votes").doc();

      batch.set(voteRef, {
        categoryId,
        candidateId,
        code: data.code,
        codeRef: doc.ref,
        type,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
      });

      batch.update(doc.ref, {
        used: true,
        usedAt: firebase.firestore.FieldValue.serverTimestamp(),
        usedCategoryId: categoryId,
        usedCandidateId: candidateId,
      });

      await batch.commit();
      return { ok: true, message: "–ì–æ–ª–æ—Å –∑–∞—Å—á–∏—Ç–∞–Ω! –°–ø–∞—Å–∏–±–æ üíú" };
    }

    // --- UI helpers ----------------------------------------------------------
    function classNames(...classes) {
      return classes.filter(Boolean).join(" ");
    }

    const LoadingSpinner = ({ label = "–ó–∞–≥—Ä—É–∑–∫–∞..." }) => (
      <div className="flex items-center justify-center py-16">
        <div className="flex flex-col items-center gap-4">
          <div className="h-10 w-10 rounded-full border-2 border-fuchsia-400 border-t-transparent animate-spin" />
          <p className="text-sm text-slate-300 tracking-wide uppercase">{label}</p>
        </div>
      </div>
    );

    const Pill = ({ children }) => (
      <span className="inline-flex items-center rounded-full border border-fuchsia-500/40 bg-fuchsia-500/10 px-3 py-1 text-xs font-medium tracking-wide uppercase text-fuchsia-200">
        {children}
      </span>
    );

    // --- Layout --------------------------------------------------------------
    const Header = () => (
      <header className="sticky top-0 z-30 border-b border-slate-800/60 bg-slate-950/70 backdrop-blur-xl">
        <div className="mx-auto flex max-w-6xl items-center justify-between px-4 py-4">
          <Link to="/" className="group inline-flex items-center gap-2">
            <div className="h-8 w-8 rounded-xl bg-gradient-to-tr from-fuchsia-500 via-sky-400 to-emerald-400 shadow-glow group-hover:scale-105 transition" />
            <div>
              <p className="text-xs uppercase tracking-[0.28em] text-slate-400">
                SCHOOL SLAY
              </p>
              <p className="text-sm font-semibold text-slate-100 group-hover:text-fuchsia-200 transition">
                Awards 2025
              </p>
            </div>
          </Link>
          <nav className="flex items-center gap-2 text-sm">
            <NavLink
              to="/categories"
              className={({ isActive }) =>
                classNames(
                  "rounded-full px-3 py-1.5 transition text-xs font-medium tracking-wide uppercase",
                  isActive
                    ? "bg-fuchsia-500/20 text-fuchsia-200 border border-fuchsia-400/60"
                    : "text-slate-300 hover:text-white hover:bg-slate-800/60"
                )
              }
            >
              –ù–æ–º–∏–Ω–∞—Ü–∏–∏
            </NavLink>
            <NavLink
              to="/results"
              className={({ isActive }) =>
                classNames(
                  "rounded-full px-3 py-1.5 transition text-xs font-medium tracking-wide uppercase",
                  isActive
                    ? "bg-emerald-500/20 text-emerald-200 border border-emerald-400/60"
                    : "text-slate-300 hover:text-white hover:bg-slate-800/60"
                )
              }
            >
              –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
            </NavLink>
            <NavLink
              to="/admin"
              className={({ isActive }) =>
                classNames(
                  "rounded-full px-3 py-1.5 transition text-xs font-medium tracking-wide uppercase",
                  isActive
                    ? "bg-sky-500/20 text-sky-200 border border-sky-400/60"
                    : "text-slate-400 hover:text-white hover:bg-slate-800/60"
                )
              }
            >
              –ê–¥–º–∏–Ω–∫–∞
            </NavLink>
          </nav>
        </div>
      </header>
    );

    const Footer = () => (
      <footer className="border-t border-slate-900/60 bg-slate-950/80">
        <div className="mx-auto flex max-w-6xl flex-col gap-3 px-4 py-6 text-xs text-slate-500 md:flex-row md:items-center md:justify-between">
          <p>¬© {new Date().getFullYear()} SCHOOL SLAY AWARDS. –í—Å–µ –ø—Ä–∞–≤–∞ —Å–≤–æ–±–æ–¥–Ω—ã.</p>
          <p className="text-[11px] text-slate-500">
            –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ: 70% –∞—É–¥–∏—Ç–æ—Ä–∏—è ¬∑ 30% –∂—é—Ä–∏ ¬∑ Firebase + React SPA.
          </p>
        </div>
      </footer>
    );

    const Layout = ({ children }) => (
      <div className="min-h-screen flex flex-col">
        <Header />
        <main className="flex-1">
          <div className="mx-auto max-w-6xl px-4 py-10">{children}</div>
        </main>
        <Footer />
      </div>
    );

    // --- Pages ---------------------------------------------------------------
    const HomePage = () => {
      const { navigate } = useRouter();

      return (
        <Layout>
          <section className="grid gap-10 lg:grid-cols-[3fr,2fr] items-center">
            <div className="space-y-8">
              <Pill>SCHOOL SLAY AWARD ‚Ä¢ 2025</Pill>
              <h1 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold leading-tight">
                <span className="block bg-gradient-to-r from-fuchsia-400 via-sky-300 to-emerald-300 bg-clip-text text-transparent">
                  SCHOOL SLAY
                </span>
                <span className="mt-1 block text-slate-100">
                  Award 2025
                </span>
              </h1>
              <p className="max-w-xl text-sm sm:text-base text-slate-300">
                –°–∞–º–∞—è —Å—Ç–∏–ª—å–Ω–∞—è —à–∫–æ–ª—å–Ω–∞—è –ø—Ä–µ–º–∏—è –≥–æ–¥–∞. –ì–æ–ª–æ—Å—É–π –∑–∞ —Ç–µ—Ö, –∫—Ç–æ{" "}
                <span className="text-fuchsia-300 font-semibold">—Ä–µ–∞–ª—å–Ω–æ —Å–ª—ç–π—Ç</span>:
                –ª—É—á—à–∏–µ –æ–±—Ä–∞–∑—ã, –≤–∞–π–±, –∫—Ä–µ–∞—Ç–∏–≤ –∏ —Ö–∞—Ä–∏–∑–º–∞.
              </p>
              <div className="flex flex-wrap gap-3">
                <button
                  onClick={() => navigate("/categories")}
                  className="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-fuchsia-500 via-sky-400 to-emerald-400 px-6 py-3 text-sm font-semibold text-slate-950 shadow-glow transition hover:brightness-110"
                >
                  –ü–µ—Ä–µ–π—Ç–∏ –∫ –Ω–æ–º–∏–Ω–∞—Ü–∏—è–º
                  <span className="text-lg">‚Üí</span>
                </button>
                <button
                  onClick={() => navigate("/results")}
                  className="inline-flex items-center gap-2 rounded-full border border-slate-700/70 bg-slate-900/80 px-6 py-3 text-sm font-medium text-slate-200 transition hover:border-slate-500 hover:bg-slate-800"
                >
                  –°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                </button>
              </div>
              <div className="grid gap-3 text-xs text-slate-400 sm:grid-cols-3">
                <div className="rounded-2xl border border-slate-800/70 bg-slate-900/70 p-4">
                  <p className="text-[10px] uppercase tracking-[0.22em] text-slate-500">
                    –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
                  </p>
                  <p className="mt-1 font-semibold text-slate-100">
                    –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã
                  </p>
                  <p className="mt-1 text-xs text-slate-400">
                    –ö–∞–∂–¥—ã–π –∫–æ–¥ ‚Äî –æ–¥–∏–Ω –≥–æ–ª–æ—Å. –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –∏ —á–µ—Å—Ç–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç.
                  </p>
                </div>
                <div className="rounded-2xl border border-slate-800/70 bg-slate-900/70 p-4">
                  <p className="text-[10px] uppercase tracking-[0.22em] text-slate-500">
                    –§–æ—Ä–º—É–ª–∞
                  </p>
                  <p className="mt-1 font-semibold text-slate-100">
                    70% –∞—É–¥–∏—Ç–æ—Ä–∏—è ¬∑ 30% –∂—é—Ä–∏
                  </p>
                  <p className="mt-1 text-xs text-slate-400">
                    –ö–æ–¥—ã –∑—Ä–∏—Ç–µ–ª–µ–π –∏ –∂—é—Ä–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –∏ —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è –≤ —Ñ–∏–Ω–∞–ª–µ.
                  </p>
                </div>
                <div className="rounded-2xl border border-slate-800/70 bg-slate-900/70 p-4">
                  <p className="text-[10px] uppercase tracking-[0.22em] text-slate-500">
                    Live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                  </p>
                  <p className="mt-1 font-semibold text-slate-100">
                    Firebase Firestore
                  </p>
                  <p className="mt-1 text-xs text-slate-400">
                    –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–±–ª–∞–∫–µ. –ê–¥–º–∏–Ω–∫–∞ –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
                  </p>
                </div>
              </div>
            </div>

            <div className="relative">
              <div className="glass rounded-3xl p-6 sm:p-8">
                <p className="text-xs uppercase tracking-[0.28em] text-slate-400">
                  LIVE DASHBOARD
                </p>
                <p className="mt-2 text-lg font-semibold text-slate-100">
                  SCHOOL SLAY ‚Ä¢ –ü–∞–Ω–µ–ª—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
                </p>
                <div className="mt-6 space-y-4 text-xs">
                  <div className="flex items-center justify-between">
                    <span className="text-slate-300">–ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –∫–æ–¥–æ–≤</span>
                    <span className="text-fuchsia-300 font-semibold">75%</span>
                  </div>
                  <div className="h-1.5 overflow-hidden rounded-full bg-slate-800">
                    <div className="h-full w-3/4 rounded-full bg-gradient-to-r from-fuchsia-500 via-sky-400 to-emerald-400" />
                  </div>
                  <div className="grid grid-cols-3 gap-3 text-[11px]">
                    <div className="rounded-2xl border border-fuchsia-500/30 bg-fuchsia-500/5 p-3">
                      <p className="text-slate-400">–ù–æ–º–∏–Ω–∞—Ü–∏–π</p>
                      <p className="mt-1 text-lg font-semibold text-fuchsia-200">8</p>
                    </div>
                    <div className="rounded-2xl border border-sky-500/30 bg-sky-500/5 p-3">
                      <p className="text-slate-400">–ö–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</p>
                      <p className="mt-1 text-lg font-semibold text-sky-200">32</p>
                    </div>
                    <div className="rounded-2xl border border-emerald-500/30 bg-emerald-500/5 p-3">
                      <p className="text-slate-400">–ì–æ–ª–æ—Å–æ–≤</p>
                      <p className="mt-1 text-lg font-semibold text-emerald-200">1 248</p>
                    </div>
                  </div>
                </div>
                <div className="mt-6 flex items-center justify-between border-t border-slate-800 pt-4 text-[11px] text-slate-400">
                  <span>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º.</span>
                  <Link
                    to="/admin"
                    className="inline-flex items-center gap-1 rounded-full border border-slate-700/70 px-3 py-1 text-xs font-medium text-slate-200 hover:border-sky-400 hover:text-sky-200 transition"
                  >
                    –í–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É
                    <span>‚Üó</span>
                  </Link>
                </div>
              </div>

              <div className="pointer-events-none absolute -right-6 -top-6 h-28 w-28 rounded-full bg-fuchsia-500/20 blur-3xl" />
              <div className="pointer-events-none absolute -bottom-10 -left-10 h-32 w-32 rounded-full bg-sky-400/20 blur-3xl" />
            </div>
          </section>
        </Layout>
      );
    };

    const CategoriesPage = () => {
      const [categories, setCategories] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      useEffect(() => {
        const load = async () => {
          setLoading(true);
          setError(null);
          try {
            let ref = db.collection("categories");
            try {
              ref = ref.orderBy("order", "asc");
            } catch (_) {}
            const snap = await ref.get();
            const list = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            setCategories(list);
          } catch (e) {
            console.error(e);
            setError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–æ–º–∏–Ω–∞—Ü–∏–π.");
          } finally {
            setLoading(false);
          }
        };
        load();
      }, []);

      return (
        <Layout>
          <div className="mb-8 flex items-center justify-between gap-4">
            <div>
              <Pill>–ù–æ–º–∏–Ω–∞—Ü–∏–∏</Pill>
              <h2 className="mt-3 text-2xl sm:text-3xl font-bold text-slate-50">
                –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ SCHOOL SLAY 2025
              </h2>
              <p className="mt-2 text-sm text-slate-400 max-w-xl">
                –í—ã–±–µ—Ä–∏ –Ω–æ–º–∏–Ω–∞—Ü–∏—é, –ø–æ—Å–º–æ—Ç—Ä–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏ –ø—Ä–æ–≥–æ–ª–æ—Å—É–π —Å –ø–æ–º–æ—â—å—é —Å–≤–æ–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞.
              </p>
            </div>
            <div className="hidden sm:flex flex-col items-end text-xs text-slate-400">
              <span>–ö–æ–¥—ã –∑—Ä–∏—Ç–µ–ª–µ–π –∏ –∂—é—Ä–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.</span>
              <span>–°–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ —Å—á–∏—Ç–∞–µ—Ç 70% + 30%.</span>
            </div>
          </div>

          {loading && <LoadingSpinner label="–ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–º–∏–Ω–∞—Ü–∏–∏..." />}
          {error && (
            <div className="rounded-2xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-100">
              {error}
            </div>
          )}

          {!loading && !error && categories.length === 0 && (
            <div className="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-8 text-sm text-slate-300">
              –ù–æ–º–∏–Ω–∞—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç. –ó–∞–π–¥–∏—Ç–µ –≤{" "}
              <Link to="/admin" className="text-sky-300 underline underline-offset-2">
                –∞–¥–º–∏–Ω–∫—É
              </Link>{" "}
              –∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
            </div>
          )}

          <div className="grid gap-6 md:grid-cols-2">
            {categories.map((cat) => (
              <Link
                key={cat.id}
                to={`/categories/${cat.id}`}
                className="group relative overflow-hidden rounded-3xl border border-slate-800/70 bg-slate-900/70 p-6 transition hover:-translate-y-1 hover:border-fuchsia-500/60 hover:bg-slate-900 hover:shadow-2xl hover:shadow-fuchsia-500/25"
              >
                <div className="absolute inset-0 pointer-events-none opacity-0 group-hover:opacity-100 transition">
                  <div className="absolute -right-10 -top-10 h-32 w-32 rounded-full bg-fuchsia-500/20 blur-3xl" />
                </div>
                <div className="flex items-start justify-between gap-4 relative">
                  <div>
                    <p className="text-[11px] uppercase tracking-[0.26em] text-slate-400">
                      –ù–æ–º–∏–Ω–∞—Ü–∏—è
                    </p>
                    <h3 className="mt-1 text-lg font-semibold text-slate-50">
                      {cat.name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}
                    </h3>
                    {cat.description && (
                      <p className="mt-2 text-xs text-slate-400 line-clamp-3">
                        {cat.description}
                      </p>
                    )}
                  </div>
                  <span className="inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-slate-700/80 bg-slate-900/90 text-slate-400 group-hover:border-fuchsia-400 group-hover:text-fuchsia-200 transition">
                    ‚Üí
                  </span>
                </div>
                <div className="mt-4 flex items-center justify-between text-[11px] text-slate-500">
                  <span>–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å</span>
                  <span className="rounded-full border border-slate-700/60 px-2 py-0.5">
                    –ö–æ–¥ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
                  </span>
                </div>
              </Link>
            ))}
          </div>
        </Layout>
      );
    };

    const CategoryDetailPage = ({ categoryId }) => {
      const [category, setCategory] = useState(null);
      const [candidates, setCandidates] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [selectedCandidateId, setSelectedCandidateId] = useState(null);
      const [code, setCode] = useState("");
      const [status, setStatus] = useState(null);
      const [statusType, setStatusType] = useState("info");
      const [isVoting, setIsVoting] = useState(false);
      const [hasVoted, setHasVoted] = useState(false);

      useEffect(() => {
        const load = async () => {
          setLoading(true);
          setError(null);
          try {
            const doc = await db.collection("categories").doc(categoryId).get();
            if (!doc.exists) {
              setError("–¢–∞–∫–∞—è –Ω–æ–º–∏–Ω–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.");
              setLoading(false);
              return;
            }
            setCategory({ id: doc.id, ...doc.data() });
            const candSnap = await db
              .collection("candidates")
              .where("categoryId", "==", categoryId)
              .get();
            const list = candSnap.docs.map(d => ({ id: d.id, ...d.data() }));
            setCandidates(list);
          } catch (e) {
            console.error(e);
            setError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –Ω–æ–º–∏–Ω–∞—Ü–∏–∏.");
          } finally {
            setLoading(false);
          }
        };
        if (categoryId) load();
      }, [categoryId]);

      const selectedCandidate = candidates.find(c => c.id === selectedCandidateId) || null;

      const handleVote = async (e) => {
        e.preventDefault();
        if (!selectedCandidateId) {
          setStatusType("error");
          setStatus("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞, –∑–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å.");
          return;
        }
        if (!code.trim()) {
          setStatusType("error");
          setStatus("–í–≤–µ–¥–∏—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è.");
          return;
        }
        setIsVoting(true);
        setStatus(null);
        try {
          const result = await voteWithCode({
            code,
            categoryId,
            candidateId: selectedCandidateId,
          });
          setStatusType(result.ok ? "success" : "error");
          setStatus(result.message);
          if (result.ok) {
            setHasVoted(true);
          }
        } catch (e) {
          console.error(e);
          setStatusType("error");
          setStatus("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≥–æ–ª–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
        } finally {
          setIsVoting(false);
        }
      };

      if (loading) {
        return (
          <Layout>
            <LoadingSpinner label="–ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–º–∏–Ω–∞—Ü–∏—é..." />
          </Layout>
        );
      }

      if (error || !category) {
        return (
          <Layout>
            <div className="max-w-lg rounded-3xl border border-red-500/40 bg-red-500/10 p-6 text-sm text-red-100">
              {error || "–¢–∞–∫–∞—è –Ω–æ–º–∏–Ω–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."}
              <div className="mt-4">
                <Link
                  to="/categories"
                  className="inline-flex items-center gap-1 rounded-full border border-red-400/60 bg-red-500/10 px-4 py-1.5 text-xs font-medium text-red-50 hover:bg-red-500/20 transition"
                >
                  ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –Ω–æ–º–∏–Ω–∞—Ü–∏–π
                </Link>
              </div>
            </div>
          </Layout>
        );
      }

      return (
        <Layout>
          <div className="mb-8 flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
            <div>
              <Pill>–ù–æ–º–∏–Ω–∞—Ü–∏—è</Pill>
              <h2 className="mt-3 text-2xl sm:text-3xl font-bold text-slate-50">
                {category.name}
              </h2>
              {category.description && (
                <p className="mt-2 max-w-xl text-sm text-slate-400">
                  {category.description}
                </p>
              )}
            </div>
            <Link
              to="/categories"
              className="inline-flex items-center gap-1 rounded-full border border-slate-700/70 bg-slate-900/80 px-4 py-2 text-xs font-medium text-slate-200 hover:border-slate-500 hover:bg-slate-800 transition"
            >
              ‚Üê –í—Å–µ –Ω–æ–º–∏–Ω–∞—Ü–∏–∏
            </Link>
          </div>

          <div className="grid gap-6 lg:grid-cols-[3fr,2fr] items-start">
            <div className="space-y-4">
              {candidates.length === 0 && (
                <div className="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-6 text-sm text-slate-300">
                  –í —ç—Ç–æ–π –Ω–æ–º–∏–Ω–∞—Ü–∏–∏ –µ—â—ë –Ω–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤. –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö –≤{" "}
                  <Link to="/admin" className="text-sky-300 underline underline-offset-2">
                    –∞–¥–º–∏–Ω–∫–µ
                  </Link>
                  .
                </div>
              )}

              {candidates.map(candidate => (
                <button
                  key={candidate.id}
                  onClick={() => setSelectedCandidateId(candidate.id)}
                  className={classNames(
                    "group flex w-full items-center gap-4 rounded-3xl border px-4 py-3 text-left transition",
                    "hover:-translate-y-0.5 hover:shadow-xl hover:shadow-fuchsia-500/20",
                    selectedCandidateId === candidate.id
                      ? "border-fuchsia-400/70 bg-fuchsia-500/10"
                      : "border-slate-800/70 bg-slate-900/70 hover:border-fuchsia-500/40"
                  )}
                >
                  <div className="relative h-16 w-16 overflow-hidden rounded-2xl border border-slate-700/80 bg-slate-800/80 flex-shrink-0">
                    {candidate.photoUrl ? (
                      <img
                        src={candidate.photoUrl}
                        alt={candidate.name}
                        className="h-full w-full object-cover transition duration-500 group-hover:scale-110"
                      />
                    ) : (
                      <div className="flex h-full w-full items-center justify-center text-xs text-slate-500">
                        no photo
                      </div>
                    )}
                    {selectedCandidateId === candidate.id && (
                      <div className="pointer-events-none absolute inset-0 border-2 border-fuchsia-400/80" />
                    )}
                  </div>
                  <div className="flex-1">
                    <p className="text-sm font-semibold text-slate-50">
                      {candidate.name || "–ë–µ–∑ –∏–º–µ–Ω–∏"}
                    </p>
                    {candidate.description && (
                      <p className="mt-1 text-xs text-slate-400 line-clamp-2">
                        {candidate.description}
                      </p>
                    )}
                    <p className="mt-2 text-[11px] text-slate-500">
                      –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —ç—Ç–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞.
                    </p>
                  </div>
                  <div>
                    <span
                      className={classNames(
                        "inline-flex h-7 w-7 items-center justify-center rounded-full text-xs font-semibold",
                        selectedCandidateId === candidate.id
                          ? "bg-fuchsia-500 text-slate-950"
                          : "border border-slate-700/80 text-slate-400 group-hover:border-fuchsia-400 group-hover:text-fuchsia-200"
                      )}
                    >
                      {selectedCandidateId === candidate.id ? "‚úì" : "‚Üí"}
                    </span>
                  </div>
                </button>
              ))}
            </div>

            <div className="glass rounded-3xl p-6">
              <p className="text-[11px] uppercase tracking-[0.26em] text-slate-400">
                –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
              </p>
              <h3 className="mt-2 text-lg font-semibold text-slate-50">
                –û—Ç–¥–∞—Ç—å –≥–æ–ª–æ—Å –∑–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
              </h3>
              <p className="mt-1 text-xs text-slate-400">
                –í–≤–µ–¥–∏—Ç–µ –≤—ã–¥–∞–Ω–Ω—ã–π –≤–∞–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º–∏ –∫–æ–¥. –ö–∞–∂–¥—ã–π –∫–æ–¥ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ
                –æ–¥–∏–Ω —Ä–∞–∑, –∏ —Ç–æ–ª—å–∫–æ –∑–∞ –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –≤ –Ω–æ–º–∏–Ω–∞—Ü–∏–∏.
              </p>

              <div className="mt-4 rounded-2xl border border-slate-800 bg-slate-900/80 p-3 text-xs text-slate-300">
                <p className="font-medium text-slate-100">–í—ã–±—Ä–∞–Ω–Ω—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç</p>
                {selectedCandidate ? (
                  <div className="mt-2 flex items-center gap-3">
                    <div className="h-10 w-10 overflow-hidden rounded-xl border border-slate-700/80 bg-slate-800">
                      {selectedCandidate.photoUrl ? (
                        <img
                          src={selectedCandidate.photoUrl}
                          alt={selectedCandidate.name}
                          className="h-full w-full object-cover"
                        />
                      ) : null}
                    </div>
                    <div>
                      <p className="text-sm font-semibold text-slate-50">
                        {selectedCandidate.name}
                      </p>
                      {selectedCandidate.description && (
                        <p className="text-[11px] text-slate-400 line-clamp-2">
                          {selectedCandidate.description}
                        </p>
                      )}
                    </div>
                  </div>
                ) : (
                  <p className="mt-2 text-xs text-slate-400">
                    –ö–∞–Ω–¥–∏–¥–∞—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω. –°–Ω–∞—á–∞–ª–∞ –∫–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å–ª–µ–≤–∞.
                  </p>
                )}
              </div>

              <form onSubmit={handleVote} className="mt-4 space-y-4">
                <div className="space-y-2">
                  <label className="text-xs font-medium text-slate-200">
                    –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
                  </label>
                  <input
                    type="text"
                    value={code}
                    onChange={e => setCode(e.target.value)}
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: SLAY-9F3K-LM2Q"
                    disabled={hasVoted || isVoting}
                    className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2.5 text-sm text-slate-100 outline-none transition placeholder:text-slate-600 focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-500/60 disabled:opacity-60"
                  />
                  <p className="text-[11px] text-slate-500">
                    –ö–æ–¥—ã –∂—é—Ä–∏ –∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –≤—ã–≥–ª—è–¥—è—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ, –Ω–æ —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ —Ä–∞–∑–ª–∏—á–∞–µ—Ç –∏—Ö
                    —Ç–∏–ø –≤–Ω—É—Ç—Ä–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
                  </p>
                </div>

                {status && (
                  <div
                    className={classNames(
                      "rounded-2xl border px-3 py-2 text-xs",
                      statusType === "success"
                        ? "border-emerald-400/60 bg-emerald-500/10 text-emerald-100"
                        : "border-red-400/60 bg-red-500/10 text-red-100"
                    )}
                  >
                    {status}
                  </div>
                )}

                <button
                  type="submit"
                  disabled={hasVoted || isVoting || !selectedCandidateId}
                  className={classNames(
                    "inline-flex w-full items-center justify-center gap-2 rounded-full px-4 py-2.5 text-sm font-semibold transition",
                    hasVoted
                      ? "bg-emerald-500/20 text-emerald-100 border border-emerald-400/60 cursor-default"
                      : "bg-gradient-to-r from-fuchsia-500 via-sky-400 to-emerald-400 text-slate-950 shadow-glow hover:brightness-110 disabled:cursor-not-allowed disabled:opacity-60"
                  )}
                >
                  {hasVoted ? "–ì–æ–ª–æ—Å —É—á—Ç—ë–Ω" : isVoting ? "–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–æ–ª–æ—Å..." : "–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å"}
                </button>
              </form>

              <p className="mt-3 text-[11px] text-slate-500">
                –ü–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–æ–¥ –Ω–µ–ª—å–∑—è. –ï—Å–ª–∏ –≤—ã –æ—à–∏–±–ª–∏—Å—å —Å –≤—ã–±–æ—Ä–æ–º
                –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ ‚Äî –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º.
              </p>
            </div>
          </div>
        </Layout>
      );
    };

    const ResultsPage = () => {
      const [categories, setCategories] = useState([]);
      const [resultsByCategory, setResultsByCategory] = useState({});
      const [winnersByCategory, setWinnersByCategory] = useState({});
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      useEffect(() => {
        const load = async () => {
          setLoading(true);
          setError(null);
          try {
            const [catSnap, candSnap, votesSnap] = await Promise.all([
              db.collection("categories").get(),
              db.collection("candidates").get(),
              db.collection("votes").get(),
            ]);

            const categoriesList = catSnap.docs.map(d => ({ id: d.id, ...d.data() }));
            const candidates = candSnap.docs.map(d => ({ id: d.id, ...d.data() }));
            const votes = votesSnap.docs.map(d => ({ id: d.id, ...d.data() }));

            const candidatesByCategory = {};
            candidates.forEach(c => {
              const catId = c.categoryId || "unknown";
              if (!candidatesByCategory[catId]) {
                candidatesByCategory[catId] = [];
              }
              candidatesByCategory[catId].push(c);
            });

            const statsByCategory = {};
            votes.forEach(v => {
              const catId = v.categoryId || "unknown";
              if (!statsByCategory[catId]) {
                statsByCategory[catId] = {
                  audienceTotals: {},
                  juryTotals: {},
                  totalAudience: 0,
                  totalJury: 0,
                };
              }
              const type = v.type || "audience";
              const candidateId = v.candidateId;
              const stats = statsByCategory[catId];
              if (type === "jury") {
                stats.juryTotals[candidateId] = (stats.juryTotals[candidateId] || 0) + 1;
                stats.totalJury += 1;
              } else {
                stats.audienceTotals[candidateId] = (stats.audienceTotals[candidateId] || 0) + 1;
                stats.totalAudience += 1;
              }
            });

            const resByCategory = {};
            const winners = {};

            categoriesList.forEach(cat => {
              const catId = cat.id;
              const stats =
                statsByCategory[catId] || {
                  audienceTotals: {},
                  juryTotals: {},
                  totalAudience: 0,
                  totalJury: 0,
                };
              const cands = candidatesByCategory[catId] || [];

              const rows = cands.map(candidate => {
                const aCount = stats.audienceTotals[candidate.id] || 0;
                const jCount = stats.juryTotals[candidate.id] || 0;
                const aPercent = stats.totalAudience ? aCount / stats.totalAudience : 0;
                const jPercent = stats.totalJury ? jCount / stats.totalJury : 0;
                const combined = 0.7 * aPercent + 0.3 * jPercent;

                return {
                  candidate,
                  audienceCount: aCount,
                  juryCount: jCount,
                  audiencePercent: aPercent,
                  juryPercent: jPercent,
                  score: combined,
                };
              });

              rows.sort((a, b) => b.score - a.score);
              resByCategory[catId] = rows;
              winners[catId] = rows[0] || null;
            });

            setCategories(categoriesList);
            setResultsByCategory(resByCategory);
            setWinnersByCategory(winners);
          } catch (e) {
            console.error(e);
            setError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è.");
          } finally {
            setLoading(false);
          }
        };
        load();
      }, []);

      return (
        <Layout>
          <div className="mb-8 flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
            <div>
              <Pill>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</Pill>
              <h2 className="mt-3 text-2xl sm:text-3xl font-bold text-slate-50">
                –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ SCHOOL SLAY AWARDS 2025
              </h2>
              <p className="mt-2 max-w-xl text-sm text-slate-400">
                –ò—Ç–æ–≥–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:{" "}
                <span className="font-semibold text-slate-100">
                  70% –≥–æ–ª–æ—Å–æ–≤ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ + 30% –≥–æ–ª–æ—Å–æ–≤ –∂—é—Ä–∏
                </span>
                . –ï—Å–ª–∏ –≤ –∫–∞–∫–æ–π‚Äë—Ç–æ –Ω–æ–º–∏–Ω–∞—Ü–∏–∏ –Ω–µ—Ç –≥–æ–ª–æ—Å–æ–≤ –∂—é—Ä–∏, –∏—Ö –¥–æ–ª—è —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω—É–ª–µ–≤–æ–π.
              </p>
            </div>
            <div className="rounded-2xl border border-slate-800 bg-slate-900/80 p-4 text-xs text-slate-300">
              <p className="font-medium text-slate-100">–ö–∞–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç?</p>
              <p className="mt-1">
                –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —Å—á–∏—Ç–∞–µ–º –¥–æ–ª—é –≥–æ–ª–æ—Å–æ–≤ –∑—Ä–∏—Ç–µ–ª–µ–π –∏ –¥–æ–ª—é –≥–æ–ª–æ—Å–æ–≤ –∂—é—Ä–∏ –≤ —Ä–∞–º–∫–∞—Ö
                –æ–¥–Ω–æ–π –Ω–æ–º–∏–Ω–∞—Ü–∏–∏. –ó–∞—Ç–µ–º —Å–º–µ—à–∏–≤–∞–µ–º: 0.7 √ó –¥–æ–ª—è –∑—Ä–∏—Ç–µ–ª–µ–π + 0.3 √ó –¥–æ–ª—è –∂—é—Ä–∏.
              </p>
            </div>
          </div>

          {loading && <LoadingSpinner label="–°—á–∏—Ç–∞–µ–º –≥–æ–ª–æ—Å–∞..." />}
          {error && (
            <div className="rounded-2xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-100">
              {error}
            </div>
          )}

          {!loading && !error && categories.length === 0 && (
            <div className="rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-8 text-sm text-slate-300">
              –ù–æ–º–∏–Ω–∞—Ü–∏–π –µ—â—ë –Ω–µ—Ç. –î–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ –∞–¥–º–∏–Ω–∫–µ, –ø–æ—Å–ª–µ —á–µ–≥–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
            </div>
          )}

          <div className="space-y-8">
            {categories.map(cat => {
              const winner = winnersByCategory[cat.id];
              const rows = resultsByCategory[cat.id] || [];
              const hasVotes = rows.some(r => r.audienceCount > 0 || r.juryCount > 0);

              return (
                <section
                  key={cat.id}
                  className="rounded-3xl border border-slate-800/70 bg-slate-900/70 p-5 sm:p-6"
                >
                  <div className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                    <div>
                      <p className="text-[11px] uppercase tracking-[0.26em] text-slate-400">
                        –ù–æ–º–∏–Ω–∞—Ü–∏—è
                      </p>
                      <h3 className="mt-1 text-lg font-semibold text-slate-50">
                        {cat.name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}
                      </h3>
                      {cat.description && (
                        <p className="mt-1 max-w-xl text-xs text-slate-400">
                          {cat.description}
                        </p>
                      )}
                    </div>
                    {hasVotes && winner && (
                      <div className="flex items-center gap-3 rounded-2xl border border-amber-400/60 bg-amber-500/10 px-3 py-2 text-xs text-amber-100">
                        <span className="flex h-8 w-8 items-center justify-center rounded-2xl bg-amber-400 text-slate-950 text-lg">
                          üèÜ
                        </span>
                        <div>
                          <p className="text-[11px] uppercase tracking-[0.18em] text-amber-200/90">
                            –ü–æ–±–µ–¥–∏—Ç–µ–ª—å
                          </p>
                          <p className="text-sm font-semibold text-amber-50">
                            {winner.candidate.name}
                          </p>
                          <p className="text-[11px] text-amber-100/80">
                            –ò—Ç–æ–≥–æ–≤—ã–π –±–∞–ª–ª: {(winner.score * 100).toFixed(1)}%
                          </p>
                        </div>
                      </div>
                    )}
                  </div>

                  {!hasVotes && (
                    <p className="mt-4 text-xs text-slate-400">
                      –ì–æ–ª–æ—Å–æ–≤ –ø–æ —ç—Ç–æ–π –Ω–æ–º–∏–Ω–∞—Ü–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞
                      –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è.
                    </p>
                  )}

                  {rows.length > 0 && (
                    <div className="mt-4 overflow-x-auto">
                      <table className="min-w-full text-left text-xs text-slate-200">
                        <thead>
                          <tr className="border-b border-slate-800/80 text-[11px] uppercase tracking-[0.22em] text-slate-400">
                            <th className="py-2 pr-4">–ö–∞–Ω–¥–∏–¥–∞—Ç</th>
                            <th className="py-2 px-4 text-right">–ì–æ–ª–æ—Å–∞ –∞—É–¥–∏—Ç–æ—Ä–∏–∏</th>
                            <th className="py-2 px-4 text-right">–ì–æ–ª–æ—Å–∞ –∂—é—Ä–∏</th>
                            <th className="py-2 px-4 text-right">–ò—Ç–æ–≥–æ–≤—ã–π %</th>
                          </tr>
                        </thead>
                        <tbody>
                          {rows.map((row, index) => (
                            <tr
                              key={row.candidate.id}
                              className={classNames(
                                "border-b border-slate-900/80",
                                index === 0 ? "bg-fuchsia-500/5" : ""
                              )}
                            >
                              <td className="py-2 pr-4">
                                <div className="flex items-center gap-2">
                                  <span className="text-[11px] text-slate-500 w-5">
                                    {index + 1}.
                                  </span>
                                  <div className="h-8 w-8 overflow-hidden rounded-xl border border-slate-800/80 bg-slate-900/80 flex-shrink-0">
                                    {row.candidate.photoUrl ? (
                                      <img
                                        src={row.candidate.photoUrl}
                                        alt={row.candidate.name}
                                        className="h-full w-full object-cover"
                                      />
                                    ) : null}
                                  </div>
                                  <span className="text-sm font-medium text-slate-100">
                                    {row.candidate.name}
                                  </span>
                                </div>
                              </td>
                              <td className="py-2 px-4 text-right text-slate-200">
                                {row.audienceCount}{" "}
                                <span className="text-[11px] text-slate-500">
                                  ({(row.audiencePercent * 100).toFixed(1)}%)
                                </span>
                              </td>
                              <td className="py-2 px-4 text-right text-slate-200">
                                {row.juryCount}{" "}
                                <span className="text-[11px] text-slate-500">
                                  ({(row.juryPercent * 100).toFixed(1)}%)
                                </span>
                              </td>
                              <td className="py-2 px-4 text-right font-semibold text-slate-50">
                                {(row.score * 100).toFixed(1)}%
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  )}
                </section>
              );
            })}
          </div>
        </Layout>
      );
    };

    // --- Admin components (–∏–∑ —Ç–≤–æ–µ–≥–æ –∫–æ–¥–∞, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —Ä–æ—É—Ç–∏–Ω–≥—É) -------

    const AdminCategories = () => {
      const [categories, setCategories] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [form, setForm] = useState({ name: "", description: "", order: "" });
      const [editingId, setEditingId] = useState(null);
      const [saving, setSaving] = useState(false);

      const load = async () => {
        setLoading(true);
        setError(null);
        try {
          let ref = db.collection("categories");
          try {
            ref = ref.orderBy("order", "asc");
          } catch (_) {}
          const snap = await ref.get();
          const list = snap.docs.map(d => ({ id: d.id, ...d.data() }));
          setCategories(list);
        } catch (e) {
          console.error(e);
          setError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.");
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => {
        load();
      }, []);

      const startEdit = (cat) => {
        setEditingId(cat.id);
        setForm({
          name: cat.name || "",
          description: cat.description || "",
          order: cat.order ?? "",
        });
      };

      const resetForm = () => {
        setEditingId(null);
        setForm({ name: "", description: "", order: "" });
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        if (!form.name.trim()) return;
        setSaving(true);
        try {
          const payload = {
            name: form.name.trim(),
            description: form.description.trim(),
          };
          const orderNum = form.order === "" ? null : Number(form.order);
          if (!Number.isNaN(orderNum) && orderNum !== null) {
            payload.order = orderNum;
          }

          if (editingId) {
            await db.collection("categories").doc(editingId).update(payload);
          } else {
            await db.collection("categories").add({
              ...payload,
              createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            });
          }
          await load();
          resetForm();
        } catch (e) {
          console.error(e);
          alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.");
        } finally {
          setSaving(false);
        }
      };

      const handleDelete = async (id) => {
        if (!window.confirm("–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é?")) return;
        try {
          await db.collection("categories").doc(id).delete();
          await load();
        } catch (e) {
          console.error(e);
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é.");
        }
      };

      return (
        <div className="space-y-6">
          <div className="glass rounded-3xl p-5">
            <p className="text-[11px] uppercase tracking-[0.26em] text-slate-400">
              –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
            </p>
            <h3 className="mt-2 text-lg font-semibold text-slate-50">
              {editingId ? "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–º–∏–Ω–∞—Ü–∏—é" : "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –Ω–æ–º–∏–Ω–∞—Ü–∏—é"}
            </h3>

            <form onSubmit={handleSubmit} className="mt-4 grid gap-4 md:grid-cols-[2fr,3fr,1fr,auto]">
              <div className="space-y-1">
                <label className="text-xs text-slate-300">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                <input
                  type="text"
                  value={form.name}
                  onChange={e => setForm({ ...form, name: e.target.value })}
                  className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none placeholder:text-slate-600 focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-500/60"
                  placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Best Outfit"
                  required
                />
              </div>
              <div className="space-y-1">
                <label className="text-xs text-slate-300">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <input
                  type="text"
                  value={form.description}
                  onChange={e => setForm({ ...form, description: e.target.value })}
                  className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none placeholder:text-slate-600 focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-500/60"
                  placeholder="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ —Å—É—Ç—å –Ω–æ–º–∏–Ω–∞—Ü–∏–∏"
                />
              </div>
              <div className="space-y-1">
                <label className="text-xs text-slate-300">–ü–æ—Ä—è–¥–æ–∫ (–æ–ø—Ü.)</label>
                <input
                  type="number"
                  value={form.order}
                  onChange={e => setForm({ ...form, order: e.target.value })}
                  className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none placeholder:text-slate-600 focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-500/60"
                  placeholder="1, 2, 3..."
                />
              </div>
              <div className="flex flex-col justify-end gap-2">
                <button
                  type="submit"
                  disabled={saving}
                  className="inline-flex items-center justify-center rounded-full bg-gradient-to-r from-fuchsia-500 to-sky-400 px-4 py-2 text-xs font-semibold text-slate-950 shadow-glow hover:brightness-110 disabled:opacity-60"
                >
                  {editingId ? "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" : "–î–æ–±–∞–≤–∏—Ç—å"}
                </button>
                {editingId && (
                  <button
                    type="button"
                    onClick={resetForm}
                    className="text-[11px] text-slate-400 underline underline-offset-2"
                  >
                    –û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                  </button>
                )}
              </div>
            </form>
          </div>

          <div className="rounded-3xl border border-slate-800/70 bg-slate-950/60 p-4">
            <div className="mb-3 flex items-center justify-between">
              <p className="text-xs font-medium text-slate-300">
                –¢–µ–∫—É—â–∏–µ –Ω–æ–º–∏–Ω–∞—Ü–∏–∏ ({categories.length})
              </p>
              <button
                onClick={load}
                className="text-[11px] text-sky-300 hover:text-sky-200 underline underline-offset-2"
              >
                –û–±–Ω–æ–≤–∏—Ç—å
              </button>
            </div>
            {loading && <p className="text-xs text-slate-400">–ó–∞–≥—Ä—É–∂–∞–µ–º...</p>}
            {error && <p className="text-xs text-red-300">{error}</p>}
            {!loading && categories.length === 0 && (
              <p className="text-xs text-slate-400">–ö–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
            )}
            <div className="mt-2 space-y-2 text-xs">
              {categories.map(cat => (
                <div
                  key={cat.id}
                  className="flex items-center justify-between gap-3 rounded-2xl border border-slate-800 bg-slate-900/80 px-3 py-2"
                >
                  <div className="min-w-0">
                    <p className="font-medium text-slate-100">
                      {cat.name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}{" "}
                      {cat.order !== undefined && cat.order !== null && (
                        <span className="text-[11px] text-slate-500">#{cat.order}</span>
                      )}
                    </p>
                    {cat.description && (
                      <p className="text-[11px] text-slate-400 line-clamp-1">{cat.description}</p>
                    )}
                  </div>
                  <div className="flex items-center gap-2">
                    <button
                      onClick={() => startEdit(cat)}
                      className="rounded-full border border-sky-400/50 px-2 py-1 text-[11px] text-sky-200 hover:bg-sky-500/10"
                    >
                      –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button
                      onClick={() => handleDelete(cat.id)}
                      className="rounded-full border border-red-400/60 px-2 py-1 text-[11px] text-red-200 hover:bg-red-500/10"
                    >
                      –£–¥–∞–ª–∏—Ç—å
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    const AdminCandidates = () => {
      const [categories, setCategories] = useState([]);
      const [candidates, setCandidates] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [form, setForm] = useState({
        categoryId: "",
        name: "",
        photoUrl: "",
        description: "",
      });
      const [editingId, setEditingId] = useState(null);
      const [saving, setSaving] = useState(false);

      const load = async () => {
        setLoading(true);
        setError(null);
        try {
          const [catSnap, candSnap] = await Promise.all([
            db.collection("categories").get(),
            db.collection("candidates").get(),
          ]);
          const cats = catSnap.docs.map(d => ({ id: d.id, ...d.data() }));
          const cands = candSnap.docs.map(d => ({ id: d.id, ...d.data() }));
          setCategories(cats);
          setCandidates(cands);
          if (!form.categoryId && cats[0]) {
            setForm(f => ({ ...f, categoryId: cats[0].id }));
          }
        } catch (e) {
          console.error(e);
          setError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.");
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => {
        load();
      }, []);

      const resetForm = () => {
        setEditingId(null);
        setForm({
          categoryId: categories[0]?.id || "",
          name: "",
          photoUrl: "",
          description: "",
        });
      };

      const startEdit = (cand) => {
        setEditingId(cand.id);
        setForm({
          categoryId: cand.categoryId || "",
          name: cand.name || "",
          photoUrl: cand.photoUrl || "",
          description: cand.description || "",
        });
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        if (!form.name.trim() || !form.categoryId) return;
        setSaving(true);
        try {
          const payload = {
            categoryId: form.categoryId,
            name: form.name.trim(),
            photoUrl: form.photoUrl.trim(),
            description: form.description.trim(),
          };

          if (editingId) {
            await db.collection("candidates").doc(editingId).update(payload);
          } else {
            await db.collection("candidates").add({
              ...payload,
              createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            });
          }
          await load();
          resetForm();
        } catch (e) {
          console.error(e);
          alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞.");
        } finally {
          setSaving(false);
        }
      };

      const handleDelete = async (id) => {
        if (!window.confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞?")) return;
        try {
          await db.collection("candidates").doc(id).delete();
          await load();
        } catch (e) {
          console.error(e);
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞.");
        }
      };

      const candidatesByCategory = {};
      candidates.forEach(c => {
        const catId = c.categoryId || "unknown";
        if (!candidatesByCategory[catId]) candidatesByCategory[catId] = [];
        candidatesByCategory[catId].push(c);
      });

      return (
        <div className="space-y-6">
          <div className="glass rounded-3xl p-5">
            <p className="text-[11px] uppercase tracking-[0.26em] text-slate-400">
              –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏
            </p>
            <h3 className="mt-2 text-lg font-semibold text-slate-50">
              {editingId ? "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞" : "–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞"}
            </h3>

            {categories.length === 0 ? (
              <p className="mt-3 text-xs text-slate-400">
                –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ —Å–æ—Å–µ–¥–Ω–µ–π –≤–∫–ª–∞–¥–∫–µ.
              </p>
            ) : (
              <form
                onSubmit={handleSubmit}
                className="mt-4 grid gap-4 md:grid-cols-2"
              >
                <div className="space-y-2">
                  <label className="text-xs text-slate-300">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                  <select
                    value={form.categoryId}
                    onChange={e => setForm({ ...form, categoryId: e.target.value })}
                    className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-500/60"
                    required
                  >
                    {categories.map(cat => (
                      <option key={cat.id} value={cat.id}>
                        {cat.name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}
                      </option>
                    ))}
                  </select>
                </div>
                <div className="space-y-2">
                  <label className="text-xs text-slate-300">–ò–º—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</label>
                  <input
                    type="text"
                    value={form.name}
                    onChange={e => setForm({ ...form, name: e.target.value })}
                    className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none placeholder:text-slate-600 focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-500/60"
                    placeholder="–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è / –Ω–∏–∫"
                    required
                  />
                </div>
                <div className="space-y-2">
                  <label className="text-xs text-slate-300">URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</label>
                  <input
                    type="url"
                    value={form.photoUrl}
                    onChange={e => setForm({ ...form, photoUrl: e.target.value })}
                    className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none placeholder:text-slate-600 focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-500/60"
                    placeholder="https://..."
                  />
                  <p className="text-[11px] text-slate-500">
                    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (Github, Imgur, Google Drive —Å –ø—Ä—è–º—ã–º
                    –¥–æ—Å—Ç—É–ø–æ–º –∏ —Ç.–ø.).
                  </p>
                </div>
                <div className="space-y-2">
                  <label className="text-xs text-slate-300">–û–ø–∏—Å–∞–Ω–∏–µ / –ø–æ–¥–ø–∏—Å—å</label>
                  <textarea
                    rows={3}
                    value={form.description}
                    onChange={e => setForm({ ...form, description: e.target.value })}
                    className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none placeholder:text-slate-600 focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-500/60"
                    placeholder="–ù–µ–±–æ–ª—å—à–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, –∫–ª–∞—Å—Å, –≤–∞–π–±, —Ç–∏—Ç—É–ª—ã..."
                  />
                </div>
                <div className="md:col-span-2 flex items-center justify-between">
                  <button
                    type="submit"
                    disabled={saving}
                    className="inline-flex items-center justify-center rounded-full bg-gradient-to-r from-fuchsia-500 to-sky-400 px-5 py-2.5 text-xs font-semibold text-slate-950 shadow-glow hover:brightness-110 disabled:opacity-60"
                  >
                    {editingId ? "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è" : "–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞"}
                  </button>
                  {editingId && (
                    <button
                      type="button"
                      onClick={resetForm}
                      className="text-[11px] text-slate-400 underline underline-offset-2"
                    >
                      –û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                    </button>
                  )}
                </div>
              </form>
            )}
          </div>

          <div className="rounded-3xl border border-slate-800/70 bg-slate-950/60 p-4">
            <div className="mb-3 flex items-center justify-between">
              <p className="text-xs font-medium text-slate-300">
                –í—Å–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã ({candidates.length})
              </p>
              <button
                onClick={load}
                className="text-[11px] text-sky-300 hover:text-sky-200 underline underline-offset-2"
              >
                –û–±–Ω–æ–≤–∏—Ç—å
              </button>
            </div>
            {loading && <p className="text-xs text-slate-400">–ó–∞–≥—Ä—É–∂–∞–µ–º...</p>}
            {error && <p className="text-xs text-red-300">{error}</p>}
            {!loading && candidates.length === 0 && (
              <p className="text-xs text-slate-400">–ö–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
            )}

            <div className="mt-2 space-y-4 text-xs">
              {categories.map(cat => {
                const list = candidatesByCategory[cat.id] || [];
                if (list.length === 0) return null;
                return (
                  <div key={cat.id} className="space-y-2">
                    <p className="text-[11px] uppercase tracking-[0.22em] text-slate-500">
                      {cat.name}
                    </p>
                    <div className="space-y-2">
                      {list.map(cand => (
                        <div
                          key={cand.id}
                          className="flex items-center justify-between gap-3 rounded-2xl border border-slate-800 bg-slate-900/80 px-3 py-2"
                        >
                          <div className="flex items-center gap-3 min-w-0">
                            <div className="h-8 w-8 overflow-hidden rounded-xl border border-slate-800 bg-slate-900 flex-shrink-0">
                              {cand.photoUrl ? (
                                <img
                                  src={cand.photoUrl}
                                  alt={cand.name}
                                  className="h-full w-full object-cover"
                                />
                              ) : null}
                            </div>
                            <div className="min-w-0">
                              <p className="text-sm font-medium text-slate-100">
                                {cand.name || "–ë–µ–∑ –∏–º–µ–Ω–∏"}
                              </p>
                              {cand.description && (
                                <p className="text-[11px] text-slate-400 line-clamp-1">
                                  {cand.description}
                                </p>
                              )}
                            </div>
                          </div>
                          <div className="flex items-center gap-2">
                            <button
                              onClick={() => startEdit(cand)}
                              className="rounded-full border border-sky-400/50 px-2 py-1 text-[11px] text-sky-200 hover:bg-sky-500/10"
                            >
                              –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button
                              onClick={() => handleDelete(cand.id)}
                              className="rounded-full border border-red-400/60 px-2 py-1 text-[11px] text-red-200 hover:bg-red-500/10"
                            >
                              –£–¥–∞–ª–∏—Ç—å
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      );
    };

    const randomChunk = (length) => {
      const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
      let out = "";
      for (let i = 0; i < length; i++) {
        out += chars[Math.floor(Math.random() * chars.length)];
      }
      return out;
    };

    const AdminCodes = () => {
      const [categories, setCategories] = useState([]);
      const [form, setForm] = useState({
        type: "audience",
        quantity: 20,
        prefix: "SLAY",
        categoryId: "",
      });
      const [generatedCodes, setGeneratedCodes] = useState([]);
      const [loading, setLoading] = useState(false);
      const [recentCodes, setRecentCodes] = useState([]);
      const [loadingRecent, setLoadingRecent] = useState(true);

      useEffect(() => {
        const loadCats = async () => {
          try {
            const snap = await db.collection("categories").get();
            const cats = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            setCategories(cats);
          } catch (e) {
            console.error(e);
          }
        };
        const loadRecent = async () => {
          setLoadingRecent(true);
          try {
            const snap = await db
              .collection("codes")
              .orderBy("createdAt", "desc")
              .limit(50)
              .get();
            const list = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            setRecentCodes(list);
          } catch (e) {
            console.error(e);
          } finally {
            setLoadingRecent(false);
          }
        };
        loadCats();
        loadRecent();
      }, []);

      const handleGenerate = async (e) => {
        e.preventDefault();
        const qty = Number(form.quantity);
        if (!qty || qty <= 0 || qty > 500) {
          alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç 1 –¥–æ 500.");
          return;
        }
        setLoading(true);
        try {
          const batch = db.batch();
          const codesArr = [];
          for (let i = 0; i < qty; i++) {
            const code =
              (form.prefix || "SLAY") +
              "-" +
              randomChunk(4) +
              "-" +
              randomChunk(4);
            const ref = db.collection("codes").doc();
            batch.set(ref, {
              code,
              type: form.type,
              categoryId: form.categoryId || null,
              used: false,
              createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            });
            codesArr.push(code);
          }
          await batch.commit();
          setGeneratedCodes(codesArr);
          const snap = await db
            .collection("codes")
            .orderBy("createdAt", "desc")
            .limit(50)
            .get();
          setRecentCodes(snap.docs.map(d => ({ id: d.id, ...d.data() })));
        } catch (e) {
          console.error(e);
          alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–æ–≤.");
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="space-y-6">
          <div className="glass rounded-3xl p-5">
            <p className="text-[11px] uppercase tracking-[0.26em] text-slate-400">
              –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–æ–≤
            </p>
            <h3 className="mt-2 text-lg font-semibold text-slate-50">
              –°–æ–∑–¥–∞—Ç—å –∫–æ–¥—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
            </h3>
            <p className="mt-1 text-xs text-slate-400">
              –ö–∞–∂–¥—ã–π –∫–æ–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å—Ç—Ä–æ–≥–æ –æ–¥–∏–Ω —Ä–∞–∑. –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–º–µ—Ç–∏—Ç—å —á–∞—Å—Ç—å –∫–æ–¥–æ–≤ –∫–∞–∫
              <span className="text-emerald-200"> jury</span> ‚Äî –æ–Ω–∏ –±—É–¥—É—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å—Å—è –∫–∞–∫ –≥–æ–ª–æ—Å–∞
              –∂—é—Ä–∏.
            </p>

            <form
              onSubmit={handleGenerate}
              className="mt-4 grid gap-4 md:grid-cols-[1.5fr,1fr,1.5fr,auto]"
            >
              <div className="space-y-2">
                <label className="text-xs text-slate-300">–¢–∏–ø –∫–æ–¥–æ–≤</label>
                <select
                  value={form.type}
                  onChange={e => setForm({ ...form, type: e.target.value })}
                  className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-500/60"
                >
                  <option value="audience">–ê—É–¥–∏—Ç–æ—Ä–∏—è (70%)</option>
                  <option value="jury">–ñ—é—Ä–∏ (30%)</option>
                </select>
              </div>
              <div className="space-y-2">
                <label className="text-xs text-slate-300">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                <input
                  type="number"
                  min={1}
                  max={500}
                  value={form.quantity}
                  onChange={e => setForm({ ...form, quantity: e.target.value })}
                  className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-500/60"
                />
              </div>
              <div className="space-y-2">
                <label className="text-xs text-slate-300">
                  –ü—Ä–µ—Ñ–∏–∫—Å / –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–æ–ø—Ü.)
                </label>
                <div className="grid grid-cols-[1.2fr,1.8fr] gap-2">
                  <input
                    type="text"
                    value={form.prefix}
                    onChange={e => setForm({ ...form, prefix: e.target.value.toUpperCase() })}
                    className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none placeholder:text-slate-600 focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-500/60"
                    placeholder="SLAY"
                  />
                  <select
                    value={form.categoryId}
                    onChange={e => setForm({ ...form, categoryId: e.target.value })}
                    className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-500/60"
                  >
                    <option value="">–ë–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏</option>
                    {categories.map(cat => (
                      <option key={cat.id} value={cat.id}>
                        {cat.name}
                      </option>
                    ))}
                  </select>
                </div>
                <p className="text-[11px] text-slate-500">
                  –ï—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –∫–æ–¥ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –Ω–µ–π.
                </p>
              </div>
              <div className="flex items-end">
                <button
                  type="submit"
                  disabled={loading}
                  className="inline-flex items-center justify-center rounded-full bg-gradient-to-r from-fuchsia-500 to-sky-400 px-5 py-2.5 text-xs font-semibold text-slate-950 shadow-glow hover:brightness-110 disabled:opacity-60"
                >
                  {loading ? "–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º..." : "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å"}
                </button>
              </div>
            </form>

            {generatedCodes.length > 0 && (
              <div className="mt-4 rounded-2xl border border-emerald-400/60 bg-emerald-500/10 p-3 text-xs text-emerald-50">
                <p className="font-medium">–ù–æ–≤—ã–µ –∫–æ–¥—ã ({generatedCodes.length})</p>
                <p className="mt-1 text-[11px] text-emerald-100/80">
                  –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ —Ä–∞–∑–¥–∞–π—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º. –û–Ω–∏ —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Firestore (–∫–æ–ª–ª–µ–∫—Ü–∏—è
                  <span className="font-mono"> codes</span>).
                </p>
                <textarea
                  readOnly
                  className="mt-2 h-32 w-full rounded-xl border border-emerald-300/60 bg-slate-950/80 p-2 text-[11px] font-mono text-emerald-100"
                  value={generatedCodes.join("\n")}
                />
              </div>
            )}
          </div>

          <div className="rounded-3xl border border-slate-800/70 bg-slate-950/60 p-4 text-xs">
            <div className="mb-2 flex items-center justify-between">
              <p className="text-xs font-medium text-slate-300">
                –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 –∫–æ–¥–æ–≤
              </p>
              <button
                onClick={async () => {
                  setLoadingRecent(true);
                  try {
                    const snap = await db
                      .collection("codes")
                      .orderBy("createdAt", "desc")
                      .limit(50)
                      .get();
                    setRecentCodes(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                  } catch (e) {
                    console.error(e);
                  } finally {
                    setLoadingRecent(false);
                  }
                }}
                className="text-[11px] text-sky-300 hover:text-sky-200 underline underline-offset-2"
              >
                –û–±–Ω–æ–≤–∏—Ç—å
              </button>
            </div>
            {loadingRecent && <p className="text-slate-400">–ó–∞–≥—Ä—É–∂–∞–µ–º...</p>}
            {!loadingRecent && recentCodes.length === 0 && (
              <p className="text-slate-400">–ö–æ–¥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
            )}
            <div className="mt-2 max-h-64 space-y-1 overflow-y-auto">
              {recentCodes.map(c => (
                <div
                  key={c.id}
                  className="flex items-center justify-between gap-3 rounded-xl border border-slate-800 bg-slate-900/80 px-3 py-1.5"
                >
                  <div className="flex items-center gap-2">
                    <span
                      className={classNames(
                        "rounded-full px-2 py-0.5 text-[10px] font-semibold uppercase",
                        c.type === "jury"
                          ? "bg-emerald-500/20 text-emerald-200 border border-emerald-400/60"
                          : "bg-fuchsia-500/15 text-fuchsia-200 border border-fuchsia-400/60"
                      )}
                    >
                      {c.type === "jury" ? "–ñ—é—Ä–∏" : "–ê—É–¥–∏—Ç–æ—Ä–∏—è"}
                    </span>
                    <span className="font-mono text-[11px] text-slate-100">{c.code}</span>
                  </div>
                  <div className="flex items-center gap-2 text-[10px] text-slate-400">
                    {c.categoryId && (
                      <span className="rounded-full border border-slate-600 px-2 py-0.5">
                        cat: {c.categoryId.slice(0, 6)}‚Ä¶
                      </span>
                    )}
                    {c.used && (
                      <span className="rounded-full border border-emerald-500/60 bg-emerald-500/10 px-2 py-0.5 text-emerald-100">
                        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
                      </span>
                    )}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    const AdminVotes = () => {
      const [votes, setVotes] = useState([]);
      const [categories, setCategories] = useState({});
      const [candidates, setCandidates] = useState({});
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      const load = async () => {
        setLoading(true);
        setError(null);
        try {
          const [catSnap, candSnap, votesSnap] = await Promise.all([
            db.collection("categories").get(),
            db.collection("candidates").get(),
            db.collection("votes").orderBy("createdAt", "desc").limit(100).get(),
          ]);

          const cats = {};
          catSnap.docs.forEach(d => { cats[d.id] = { id: d.id, ...d.data() }; });
          const cands = {};
          candSnap.docs.forEach(d => { cands[d.id] = { id: d.id, ...d.data() }; });
          const vt = votesSnap.docs.map(d => ({ id: d.id, ...d.data() }));

          setCategories(cats);
          setCandidates(cands);
          setVotes(vt);
        } catch (e) {
          console.error(e);
          setError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≥–æ–ª–æ—Å–∞.");
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => {
        load();
      }, []);

      return (
        <div className="space-y-4">
          <div className="flex items-center justify-between gap-2">
            <div>
              <p className="text-[11px] uppercase tracking-[0.26em] text-slate-400">
                –ì–æ–ª–æ—Å–∞
              </p>
              <h3 className="mt-1 text-lg font-semibold text-slate-50">
                –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 –≥–æ–ª–æ—Å–æ–≤
              </h3>
            </div>
            <button
              onClick={load}
              className="rounded-full border border-sky-400/60 px-4 py-1.5 text-xs font-medium text-sky-100 hover:bg-sky-500/10"
            >
              –û–±–Ω–æ–≤–∏—Ç—å
            </button>
          </div>

          {loading && <p className="text-xs text-slate-400">–ó–∞–≥—Ä—É–∂–∞–µ–º...</p>}
          {error && <p className="text-xs text-red-300">{error}</p>}
          {!loading && votes.length === 0 && (
            <p className="text-xs text-slate-400">
              –ì–æ–ª–æ—Å–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ –∫–æ–¥—ã –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã, –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.
            </p>
          )}

          <div className="max-h-[420px] overflow-y-auto rounded-3xl border border-slate-800/70 bg-slate-950/60 text-xs">
            <table className="min-w-full text-left">
              <thead className="sticky top-0 bg-slate-950/90">
                <tr className="border-b border-slate-800/80 text-[11px] uppercase tracking-[0.22em] text-slate-400">
                  <th className="px-3 py-2">–í—Ä–µ–º—è</th>
                  <th className="px-3 py-2">–¢–∏–ø</th>
                  <th className="px-3 py-2">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                  <th className="px-3 py-2">–ö–∞–Ω–¥–∏–¥–∞—Ç</th>
                  <th className="px-3 py-2">–ö–æ–¥</th>
                </tr>
              </thead>
              <tbody>
                {votes.map(v => {
                  const cat = categories[v.categoryId];
                  const cand = candidates[v.candidateId];
                  const ts = v.createdAt?.toDate
                    ? v.createdAt.toDate()
                    : null;
                  const timeStr = ts
                    ? ts.toLocaleString("ru-RU", {
                        day: "2-digit",
                        month: "2-digit",
                        hour: "2-digit",
                        minute: "2-digit",
                      })
                    : "‚Äì";
                  return (
                    <tr key={v.id} className="border-b border-slate-900/80">
                      <td className="px-3 py-1.5 text-slate-400">{timeStr}</td>
                      <td className="px-3 py-1.5">
                        <span
                          className={classNames(
                            "rounded-full px-2 py-0.5 text-[10px] font-semibold uppercase",
                            v.type === "jury"
                              ? "bg-emerald-500/15 text-emerald-200 border border-emerald-400/60"
                              : "bg-fuchsia-500/15 text-fuchsia-200 border border-fuchsia-400/60"
                          )}
                        >
                          {v.type === "jury" ? "–ñ—é—Ä–∏" : "–ê—É–¥–∏—Ç–æ—Ä–∏—è"}
                        </span>
                      </td>
                      <td className="px-3 py-1.5 text-slate-100">
                        {cat?.name || v.categoryId || "‚Äî"}
                      </td>
                      <td className="px-3 py-1.5 text-slate-100">
                        {cand?.name || v.candidateId || "‚Äî"}
                      </td>
                      <td className="px-3 py-1.5 font-mono text-[11px] text-slate-400">
                        {v.code}
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        </div>
      );
    };

    const AdminPage = () => {
      const [isAuthed, setIsAuthed] = useState(() => {
        return window.localStorage.getItem("slay_admin_ok") === "1";
      });
      const [password, setPassword] = useState("");
      const [error, setError] = useState(null);
      const [activeTab, setActiveTab] = useState("categories");

      const handleLogin = (e) => {
        e.preventDefault();
        if (password === ADMIN_PASSWORD) {
          setIsAuthed(true);
          setError(null);
          window.localStorage.setItem("slay_admin_ok", "1");
        } else {
          setError("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.");
        }
      };

      if (!isAuthed) {
        return (
          <Layout>
            <div className="mx-auto max-w-md glass rounded-3xl p-6">
              <Pill>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</Pill>
              <h2 className="mt-3 text-xl font-semibold text-slate-50">
                –í—Ö–æ–¥ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤
              </h2>
              <p className="mt-2 text-xs text-slate-400">
                –î–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å, –∑–∞—à–∏—Ç—ã–π –≤ –∫–æ–¥–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞. –ü–µ—Ä–µ–¥ –±–æ–µ–≤—ã–º
                –∑–∞–ø—É—Å–∫–æ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ{" "}
                <span className="font-semibold text-slate-100">
                  –∑–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (Firebase Auth).
                </span>
              </p>
              <form onSubmit={handleLogin} className="mt-4 space-y-3">
                <div className="space-y-1">
                  <label className="text-xs text-slate-300">–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
                  <input
                    type="password"
                    value={password}
                    onChange={e => setPassword(e.target.value)}
                    className="w-full rounded-2xl border border-slate-700/80 bg-slate-950/80 px-3 py-2 text-sm text-slate-100 outline-none placeholder:text-slate-600 focus:border-sky-400 focus:ring-1 focus:ring-sky-500/60"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                  />
                </div>
                {error && (
                  <div className="rounded-2xl border border-red-400/60 bg-red-500/10 px-3 py-2 text-xs text-red-100">
                    {error}
                  </div>
                )}
                <button
                  type="submit"
                  className="inline-flex w-full items-center justify-center rounded-full bg-gradient-to-r from-sky-400 to-fuchsia-500 px-4 py-2.5 text-sm font-semibold text-slate-950 shadow-glow hover:brightness-110"
                >
                  –í–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É
                </button>
              </form>
            </div>
          </Layout>
        );
      }

      return (
        <Layout>
          <div className="mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
            <div>
              <Pill>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</Pill>
              <h2 className="mt-3 text-2xl font-bold text-slate-50">
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ SCHOOL SLAY AWARD 2025
              </h2>
              <p className="mt-1 text-xs text-slate-400 max-w-xl">
                –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –Ω–æ–º–∏–Ω–∞—Ü–∏—è–º–∏, –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏, –∫–æ–¥–∞–º–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –≥–æ–ª–æ—Å–∞ –≤
                —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ä–∞–∑—É —É—Ö–æ–¥—è—Ç –≤ Firestore.
              </p>
            </div>
            <button
              onClick={() => {
                window.localStorage.removeItem("slay_admin_ok");
                window.location.reload();
              }}
              className="self-start rounded-full border border-slate-700/80 bg-slate-950/80 px-4 py-2 text-xs font-medium text-slate-300 hover:border-red-400 hover:text-red-200 hover:bg-red-500/10"
            >
              –í—ã–π—Ç–∏
            </button>
          </div>

          <div className="mb-5 inline-flex rounded-full border border-slate-800 bg-slate-950/60 p-1 text-xs">
            {[
              { id: "categories", label: "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏" },
              { id: "candidates", label: "–ö–∞–Ω–¥–∏–¥–∞—Ç—ã" },
              { id: "codes", label: "–ö–æ–¥—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è" },
              { id: "votes", label: "–ì–æ–ª–æ—Å–∞" },
            ].map(tab => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={classNames(
                  "rounded-full px-3 py-1.5 font-medium transition",
                  activeTab === tab.id
                    ? "bg-sky-500 text-slate-950"
                    : "text-slate-300 hover:text-white"
                )}
              >
                {tab.label}
              </button>
            ))}
          </div>

          <div className="space-y-6">
            {activeTab === "categories" && <AdminCategories />}
            {activeTab === "candidates" && <AdminCandidates />}
            {activeTab === "codes" && <AdminCodes />}
            {activeTab === "votes" && <AdminVotes />}
          </div>
        </Layout>
      );
    };

    const NotFoundPage = () => (
      <Layout>
        <div className="mx-auto max-w-md rounded-3xl border border-slate-800 bg-slate-900/70 p-6 text-sm text-slate-200">
          <p className="text-lg font-semibold text-slate-50">–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</p>
          <p className="mt-2 text-sm text-slate-400">
            –¢–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ—Ç –≤ SCHOOL SLAY. –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –ø–µ—Ä–µ—à–ª–∏ –ø–æ —Å—Ç–∞—Ä–æ–π —Å—Å—ã–ª–∫–µ.
          </p>
          <div className="mt-4 flex gap-2">
            <Link
              to="/"
              className="inline-flex flex-1 items-center justify-center rounded-full bg-gradient-to-r from-fuchsia-500 to-sky-400 px-4 py-2 text-xs font-semibold text-slate-950 shadow-glow hover:brightness-110"
            >
              –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </Link>
            <Link
              to="/categories"
              className="inline-flex flex-1 items-center justify-center rounded-full border border-slate-700/80 bg-slate-950/80 px-4 py-2 text-xs font-semibold text-slate-200 hover:border-slate-500 hover:bg-slate-800"
            >
              –ö –Ω–æ–º–∏–Ω–∞—Ü–∏—è–º
            </Link>
          </div>
        </div>
      </Layout>
    );

    // --- Root SPA ------------------------------------------------------------
    const AppRoutes = () => {
      const { route } = useRouter();
      switch (route.name) {
        case "home":
          return <HomePage />;
        case "categories":
          return <CategoriesPage />;
        case "categoryDetail":
          return <CategoryDetailPage categoryId={route.params.categoryId} />;
        case "results":
          return <ResultsPage />;
        case "admin":
          return <AdminPage />;
        default:
          return <NotFoundPage />;
      }
    };

    const App = () => (
      <RouterProvider>
        <AppRoutes />
      </RouterProvider>
    );

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
